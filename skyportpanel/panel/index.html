#!/bin/bash

# Colors for output
GREEN='\033[0;32m'
NC='\033[0m' # No Color

echo -e "${GREEN}Updating package list and installing dependencies...${NC}"
sudo apt update
sudo apt install -y curl software-properties-common git

echo -e "${GREEN}Installing Node.js 20.x...${NC}"
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

echo -e "${GREEN}Cloning Skyport Panel from GitHub...${NC}"
git clone https://github.com/achul123/panel5.git

if [ ! -d "panel5" ]; then
    echo "❌ Failed to clone repository or folder missing!"
    exit 1
fi

cd panel5 || { echo "❌ Failed to enter panel5 directory"; exit 1; }

echo -e "${GREEN}Installing Node.js dependencies...${NC}"
npm install

echo -e "${GREEN}Seeding database...${NC}"
npm run seed

echo -e "${GREEN}Creating admin user...${NC}"
npm run createUser

echo -e "${GREEN}Installing PM2 process manager...${NC}"
sudo npm install -g pm2

echo -e "${GREEN}Starting Skyport Panel with PM2...${NC}"
pm2 start index.js --name ks-installer-skyport-panel
pm2 save

echo -e "${GREEN}✅ Skyport Panel installation complete!${NC}"

exit 0
