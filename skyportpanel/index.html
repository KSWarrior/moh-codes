#!/bin/bash

# Color Variables
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m' # No Color

# Branding
clear
echo -e "${YELLOW}==========================================${NC}"
echo -e "${CYAN}${BOLD}      Skyport Installer by KS_Warrior     ${NC}"
echo -e "${GREEN} Website : https://kswarrior.vercel.app  ${NC}"
echo -e "${GREEN} Discord : https://discord.gg/2kAYnH655h ${NC}"
echo -e "${YELLOW}==========================================${NC}"
echo ""

# Helper Functions
fade_in_menu() {
    for line in "$@"; do
        echo -e "$line"
        sleep 0.05
    done
}

echo_message() {
    echo -e "$1$2${NC}"
}

prompt_daemon() {
    echo -e "${YELLOW}Configure your node manually using the Skyport commands.${NC}"
}

skyport_menu() {
  fade_in_menu \
      "" \
      "${YELLOW}==================================${NC}" \
      "${GREEN}${BOLD}         Skyport Options         ${NC}" \
      "${YELLOW}==================================${NC}" \
      "${CYAN}1) Install Skyport Panel${NC}" \
      "${CYAN}2) Install Daemon (wings)${NC}" \
      "${CYAN}3) Start Panel${NC}" \
      "${CYAN}4) Start Daemon${NC}" \
      "${CYAN}5) Restart Panel${NC}" \
      "${CYAN}6) Restart Daemon (wings)${NC}" \
      "${CYAN}7) Create User${NC}" \
      "${CYAN}8) Exit${NC}" \
      "${CYAN}9) Install Both (Panel + Wings)${NC}" \
      "${CYAN}10) Start Both (Panel + Wings)${NC}" \
      "${CYAN}11) Restart Both (Panel + Wings)${NC}" \
      "${YELLOW}==================================${NC}" \
      ""

    echo -ne "${YELLOW}Enter your choice [1-11]: ${NC}"
    read skyport_choice
    case $skyport_choice in
        1)
            echo_message "$GREEN" "Installing Skyport Panel..."
            bash <(curl -sSL https://raw.githubusercontent.com/KSWarrior/moh-codes/refs/heads/main/skyportpanel/panel.sh)
            echo_message "$GREEN" "Skyport Panel installation completed!"
            prompt_daemon
            ;;
        2)
            echo_message "$GREEN" "Installing Daemon (wings)..."
            bash <(curl -sSL https://raw.githubusercontent.com/KSWarrior/moh-codes/refs/heads/main/skyportpanel/wings.sh)
            echo_message "$GREEN" "Daemon (wings) installation complete!"
            ;;
        3)
            echo_message "$GREEN" "Starting Skyport Panel..."
            cd panel5 && pm2 start index.js --name ks-installer-skyport-panel
            ;;
        4)
            echo_message "$GREEN" "Starting Daemon (wings)..."
            cd skyportd && pm2 start index.js --name ks-installer-skyport-wings
            ;;
        5)
            echo_message "$GREEN" "Restarting Skyport Panel..."
            pm2 restart ks-installer-skyport-panel
            ;;
        6)
            echo_message "$GREEN" "Restarting Daemon (wings)..."
            pm2 restart ks-installer-skyport-wings
            ;;
        7)
            echo_message "$GREEN" "Creating a new user..."
            if [ -d "panel5" ]; then
                cd panel5 && npm run createUser
            else
                npm run createUser
            fi
            ;;
        8)
            echo_message "$GREEN" "Exiting Skyport Installer..."
            exit 0
            ;;
        9)
            echo_message "$GREEN" "Installing Both: Panel + Wings..."
            bash <(curl -sSL https://raw.githubusercontent.com/KSWarrior/moh-codes/refs/heads/main/skyportpanel/panel.sh)
            bash <(curl -sSL https://raw.githubusercontent.com/KSWarrior/moh-codes/refs/heads/main/skyportpanel/wings.sh)
            echo_message "$GREEN" "Both installations completed!"
            prompt_daemon
            ;;
        10)
            echo_message "$GREEN" "Starting Both: Panel + Wings..."
            cd panel5 && pm2 start index.js --name ks-installer-skyport-panel
            cd ../skyportd && pm2 start index.js --name ks-installer-skyport-wings
            ;;
        11)
            echo_message "$GREEN" "Restarting Both: Panel + Wings..."
            pm2 restart ks-installer-skyport-panel
            pm2 restart ks-installer-skyport-wings
            ;;
        *)
            echo_message "$YELLOW" "Invalid choice."
            skyport_menu
            ;;
    esac
}

# Run the menu
skyport_menu
